#:import arabic_reshaper arabic_reshaper
#:import get_display bidi.algorithm.get_display
#:import dp kivy.metrics.dp

# Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
#:set arabic_text lambda text: get_display(arabic_reshaper.reshape(text)) if text else ""

# widgets/header.kv
<CustomHeader>:
    size_hint_y: None
    height: dp(70)
    padding: [dp(10), dp(5), dp(10), dp(5)]
    spacing: dp(8)
    
    canvas.before:
        Color:
            rgba: 0.11, 0.37, 0.63, 1  # Ù„ÙˆÙ† Ø£Ø²Ø±Ù‚ (#1D5FB2)
        Rectangle:
            pos: self.pos
            size: self.size
    
    # Ø§Ø³Ù… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚/Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø±
    BoxLayout:
        orientation: 'vertical'
        size_hint_x: None
        width: dp(120)
        padding: [dp(2), 0]
        spacing: dp(1)
        
        Label:
            text: arabic_text("Ø·Ø¨Ø§Ø¹Ø© Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†")
            font_size: dp(16)
            font_name: "fonts/ArbFONTS-AwanZaman-Regular.ttf"
            bold: True
            color: 1, 1, 1, 1
            halign: 'left'
            valign: 'middle'
            text_size: self.size
            size_hint_y: 0.6
        
        Label:
            text: "Online Printing"
            font_size: dp(12)
            color: 1, 1, 1, 0.8
            halign: 'left'
            valign: 'top'
            text_size: self.size
            size_hint_y: 0.4
    
    Widget:
        size_hint_x: 0.05
    
    # Ø­Ù‚Ù„ Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ù†ØªØµÙ
    BoxLayout:
        size_hint_x: 0.55
        padding: [0, dp(5), 0, dp(5)]
        
        TextInput:
            id: search_input
            hint_text: arabic_text("Ø¥Ø¨Ø¯Ø£ Ø·Ù„Ø¨ Ø·Ø¨Ø§Ø¹Ø© Ø¬Ø¯ÙŠØ¯")
            hint_text_color: [0.6, 0.6, 0.6, 1]
            multiline: False
            padding: [dp(12), dp(8)]
            font_size: dp(14)
            font_name: "fonts/ArbFONTS-AwanZaman-Regular.ttf"
            background_normal: ''
            background_active: ''
            background_color: [1, 1, 1, 0.95]
            foreground_color: [0.2, 0.2, 0.2, 1]
            write_tab: False
            halign: 'right'
            cursor_color: 0.11, 0.37, 0.63, 1
            
            canvas.before:
                Color:
                    rgba: 1, 1, 1, 0.95
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [dp(10),]
                Color:
                    rgba: 0.8, 0.8, 0.8, 0.5
                Line:
                    rounded_rectangle: [self.x, self.y, self.width, self.height, dp(10)]
                    width: 1
    
    # Ø²Ø± Ø§Ù„Ø¨Ø­Ø« Ø§Ù„ØµØºÙŠØ±
    Button:
        id: search_btn
        size_hint: None, 1
        width: dp(35)
        text: "ğŸ”"
        font_size: dp(18)
        background_color: 0, 0, 0, 0
        color: 0.11, 0.37, 0.63, 1
        on_press: 
            root._trigger_search_press(search_input.text) if hasattr(root, '_trigger_search_press') else None
            print("Ø¨Ø­Ø«")
    
    Widget:
        size_hint_x: 0.02
    
    # Ø²Ø± Ø§Ù„Ø·Ù„Ø¨Ø§Øª
    BoxLayout:
        orientation: 'vertical'
        size_hint_x: None
        width: dp(50)
        padding: [0, dp(2)]
        spacing: dp(1)
        
        Button:
            size_hint: None, None
            size: dp(30), dp(30)
            pos_hint: {'center_x': 0.5}
            text: "ğŸ“‹"
            font_size: dp(18)
            background_color: 0, 0, 0, 0
            color: 1, 1, 1, 0.9
            on_press: root._trigger_orders_press() if hasattr(root, '_trigger_orders_press') else None
        
        Label:
            text: arabic_text("Ø·Ù„Ø¨Ø§ØªÙŠ")
            font_size: dp(10)
            font_name: "fonts/ArbFONTS-AwanZaman-Regular.ttf"
            color: 1, 1, 1, 0.9
            halign: 'center'
            size_hint_y: None
            height: dp(15)
    
    # Ø²Ø± Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
    BoxLayout:
        orientation: 'vertical'
        size_hint_x: None
        width: dp(50)
        padding: [0, dp(2)]
        spacing: dp(1)
        
        Button:
            size_hint: None, None
            size: dp(30), dp(30)
            pos_hint: {'center_x': 0.5}
            text: "ğŸ‘¤"
            font_size: dp(18)
            background_color: 0, 0, 0, 0
            color: 1, 1, 1, 0.9
            on_press: root._trigger_profile_press() if hasattr(root, '_trigger_profile_press') else None
        
        Label:
            text: arabic_text("Ø­Ø³Ø§Ø¨ÙŠ")
            font_size: dp(10)
            font_name: "fonts/ArbFONTS-AwanZaman-Regular.ttf"
            color: 1, 1, 1, 0.9
            halign: 'center'
            size_hint_y: None
            height: dp(15)