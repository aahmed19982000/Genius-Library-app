#:import dp kivy.metrics.dp
#:import sp kivy.metrics.sp
#:import Window kivy.core.window.Window

<LoginScreen>:
    name: "login"
    error_message: ""
    
    BoxLayout:
        orientation: "vertical"
        spacing: 0
        padding: 0
        canvas.before:
            Color:
                rgba: 1, 1, 1, 1
            Rectangle:
                pos: self.pos
                size: self.size
        
        # مسافة رأسية من الأعلى
        Widget:
            size_hint_y: None
            height: dp(50)
        
        # العنوان الرئيسي
        BoxLayout:
            orientation: "vertical"
            size_hint_y: None
            height: dp(90)
            spacing: dp(2)
            padding: [dp(30), 0]
            
            Label:
                text: "مرحبا بعودتك !"
                font_name: "fonts/ArbFONTS-AwanZaman-Regular.ttf"
                font_size: sp(32)
                color: (0.1, 0.1, 0.1, 1)
                size_hint_y: None
                height: dp(50)
                text_size: self.width, None
                halign: "center"
                valign: "bottom"
                bold: True
                padding_y: dp(10)
            
            Label:
                text: "مرحبا بك مرة أخرى، لقد افتقدتك"
                font_name: "fonts/ArbFONTS-AwanZaman-Regular.ttf"
                font_size: sp(16)
                color: (0.6, 0.6, 0.6, 1)
                size_hint_y: None
                height: dp(30)
                text_size: self.width, None
                halign: "center"
                valign: "top"
        
        # حاوية الحقول الرئيسية
        BoxLayout:
            orientation: "vertical"
            size_hint_y: None
            height: dp(270)
            spacing: dp(25)
            padding: [dp(30), dp(25), dp(30), dp(10)]
            
            # حقل اسم المستخدم (البريد الإلكتروني أو رقم الهاتف)
            BoxLayout:
                orientation: "vertical"
                spacing: dp(8)
                size_hint_y: None
                height: dp(85)
                
                Label:
                    text: "البريد الإلكتروني أو رقم الهاتف"
                    font_name: "fonts/ArbFONTS-AwanZaman-Regular.ttf"
                    font_size: sp(15)
                    color: (0.3, 0.3, 0.3, 1)
                    size_hint_y: None
                    height: dp(22)
                    text_size: self.width, None
                    halign: "right"
                    valign: "bottom"
                    padding: [0, 0, dp(5), 0]
                
                TextInput:
                    id: username_input  # نفس التعريف الأصلي
                    multiline: False
                    font_name: "fonts/ArbFONTS-AwanZaman-Regular.ttf"
                    font_size: sp(18)
                    size_hint_y: None
                    height: dp(55)
                    padding: [dp(15), (self.height - sp(18)) / 2]
                    hint_text: "أدخل الإيميل"
                    hint_text_color: (0.75, 0.75, 0.75, 1)
                    foreground_color: (0.2, 0.2, 0.2, 1)
                    background_color: (0.96, 0.96, 0.96, 1)
                    background_normal: ""
                    background_active: ""
                    halign: "right"
                    cursor_color: (0.2, 0.2, 0.2, 1)
                    cursor_width: dp(2)
                    write_tab: False
                    on_text:
                        root.clear_error()
                    on_focus:
                        if self.focus: self.background_color = (0.93, 0.93, 0.93, 1)
                        else: self.background_color = (0.96, 0.96, 0.96, 1)
                    canvas.before:
                        Color:
                            rgba: self.background_color
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [dp(8),]
                        Color:
                            rgba: 0.82, 0.82, 0.82, 1 if self.focus else 0.9
                        Line:
                            width: dp(1.2)
                            rounded_rectangle: [self.x, self.y, self.width, self.height, dp(8)]
            
            # حقل كلمة المرور
            BoxLayout:
                orientation: "vertical"
                spacing: dp(8)
                size_hint_y: None
                height: dp(85)
                
                Label:
                    text: "كلمة المرور"
                    font_name: "fonts/ArbFONTS-AwanZaman-Regular.ttf"
                    font_size: sp(15)
                    color: (0.3, 0.3, 0.3, 1)
                    size_hint_y: None
                    height: dp(22)
                    text_size: self.width, None
                    halign: "right"
                    valign: "bottom"
                    padding: [0, 0, dp(5), 0]
                
                TextInput:
                    id: password_input  # نفس التعريف الأصلي
                    multiline: False
                    password: True
                    font_name: "fonts/ArbFONTS-AwanZaman-Regular.ttf"
                    font_size: sp(18)
                    size_hint_y: None
                    height: dp(55)
                    padding: [dp(15), (self.height - sp(18)) / 2]
                    hint_text: "**********"
                    hint_text_color: (0.75, 0.75, 0.75, 1)
                    foreground_color: (0.2, 0.2, 0.2, 1)
                    background_color: (0.96, 0.96, 0.96, 1)
                    background_normal: ""
                    background_active: ""
                    halign: "right"
                    cursor_color: (0.2, 0.2, 0.2, 1)
                    cursor_width: dp(2)
                    write_tab: False
                    on_text:
                        root.clear_error()
                    on_focus:
                        if self.focus: self.background_color = (0.93, 0.93, 0.93, 1)
                        else: self.background_color = (0.96, 0.96, 0.96, 1)
                    canvas.before:
                        Color:
                            rgba: self.background_color
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [dp(8),]
                        Color:
                            rgba: 0.82, 0.82, 0.82, 1 if self.focus else 0.9
                        Line:
                            width: dp(1.2)
                            rounded_rectangle: [self.x, self.y, self.width, self.height, dp(8)]
            
            # رابط نسيت كلمة المرور (مُحاذى لليمين)
            BoxLayout:
                orientation: "horizontal"
                size_hint_y: None
                height: dp(35)
                
                Widget:
                    size_hint_x: 0.5
                
                Button:
                    text: "هل نسيت كلمة المرور؟"
                    font_name: "fonts/ArbFONTS-AwanZaman-Regular.ttf"
                    font_size: sp(14)
                    bold: True
                    background_normal: ''
                    background_color: (0, 0, 0, 0)
                    color: (0.25, 0.6, 0.85, 1)
                    size_hint_x: 0.5
                    size_hint_y: None
                    height: dp(35)
                    padding: [0, dp(5)]
                    halign: "right"
                    valign: "middle"
                    text_size: self.width, None
                    on_release: root.show_forgot_password_screen()
        
        # حاوية رسالة الخطأ
        BoxLayout:
            id: error_container  # نفس التعريف الأصلي
            size_hint_y: None
            height: 0
            opacity: 0
            padding: [dp(30), dp(5), dp(30), dp(5)]
            
            Label:
                text: root.error_message
                font_name: "fonts/ArbFONTS-AwanZaman-Regular.ttf"
                font_size: sp(14)
                color: (0.85, 0.2, 0.2, 1)
                text_size: self.width, None
                halign: "center"
                valign: "middle"
                bold: True
        
        # زر تسجيل الدخول الكبير
        BoxLayout:
            orientation: "vertical"
            size_hint_y: None
            height: dp(100)
            padding: [dp(30), dp(15), dp(30), dp(15)]
            
            Button:
                id: login_button  # نفس التعريف الأصلي
                text: "تسجيل دخول"
                font_name: "fonts/ArbFONTS-AwanZaman-Regular.ttf"
                font_size: sp(20)
                bold: True
                background_normal: ''
                background_color: (0.22, 0.58, 0.86, 1)
                color: (1, 1, 1, 1)
                size_hint_y: None
                height: dp(55)
                on_release: root.login()
                canvas.before:
                    Color:
                        rgba: (0.18, 0.5, 0.78, 1) if self.state == 'normal' else (0.22, 0.58, 0.86, 0.9)
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [dp(10),]
        
        # رابط إنشاء حساب جديد
        BoxLayout:
            orientation: "horizontal"
            size_hint_y: None
            height: dp(45)
            padding: [dp(30), 0, dp(30), 0]
            
            # "ليس لديك حساب؟" على اليمين
            Button:
                text: "ليس لديك حساب؟"
                font_name: "fonts/ArbFONTS-AwanZaman-Regular.ttf"
                font_size: sp(15)
                bold: False
                background_normal: ''
                background_color: (0, 0, 0, 0)
                color: (0.5, 0.5, 0.5, 1)
                size_hint_x: 0.5
                size_hint_y: None
                height: dp(35)
                halign: "right"
                valign: "middle"
                text_size: self.width, None
                disabled: True
                disabled_color: (0.5, 0.5, 0.5, 1)
            
            # "إنشاء حساب جديد" على اليسار
            Button:
                text: "إنشاء حساب جديد"
                font_name: "fonts/ArbFONTS-AwanZaman-Regular.ttf"
                font_size: sp(15)
                bold: True
                background_normal: ''
                background_color: (0, 0, 0, 0)
                color: (0.25, 0.6, 0.85, 1)
                size_hint_x: 0.5
                size_hint_y: None
                height: dp(35)
                halign: "left"
                valign: "middle"
                text_size: self.width, None
                on_release: root.show_register_screen()
        
        # قسم "أو متابعة التسجيل عبر"
        BoxLayout:
            orientation: "vertical"
            size_hint_y: None
            height: dp(80)
            spacing: dp(10)
            padding: [dp(30), dp(10), dp(30), dp(5)]
            
            # الخط والكلمة في المنتصف
            BoxLayout:
                orientation: "horizontal"
                size_hint_y: None
                height: dp(30)
                
                # الخط الأيسر
                Widget:
                    size_hint_x: 0.4
                    canvas.before:
                        Color:
                            rgba: 0.88, 0.88, 0.88, 1
                        Line:
                            points: [self.right - dp(10), self.center_y, self.right, self.center_y]
                            width: dp(1.5)
                
                # الكلمة "أو" في المنتصف
                Label:
                    text: "أو"
                    font_name: "fonts/ArbFONTS-AwanZaman-Regular.ttf"
                    font_size: sp(14)
                    color: (0.7, 0.7, 0.7, 1)
                    size_hint_x: 0.2
                    text_size: self.width, None
                    halign: "center"
                    valign: "middle"
                    bold: True
                
                # الخط الأيمن
                Widget:
                    size_hint_x: 0.4
                    canvas.before:
                        Color:
                            rgba: 0.88, 0.88, 0.88, 1
                        Line:
                            points: [self.x, self.center_y, self.x + dp(10), self.center_y]
                            width: dp(1.5)
            
            # نص "متابعة التسجيل عبر"
            Label:
                text: "متابعة التسجيل عبر"
                font_name: "fonts/ArbFONTS-AwanZaman-Regular.ttf"
                font_size: sp(15)
                color: (0.5, 0.5, 0.5, 1)
                size_hint_y: None
                height: dp(25)
                text_size: self.width, None
                halign: "center"
                valign: "middle"
        
        # مساحة للأيقونات (وسائل التواصل)
        BoxLayout:
            orientation: "horizontal"
            size_hint_y: None
            height: dp(60)
            spacing: dp(20)
            padding: [dp(80), dp(5), dp(80), dp(10)]
            
            # أيقونات افتراضية (يمكن استبدالها بأيقونات حقيقية)
            Button:
                text: "G"
                font_size: sp(18)
                bold: True
                background_normal: ''
                background_color: (0.96, 0.96, 0.96, 1)
                color: (0.3, 0.3, 0.3, 1)
                size_hint_x: 0.33
                canvas.before:
                    Color:
                        rgba: 0.9, 0.9, 0.9, 1
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [dp(8),]
            
            Button:
                text: "F"
                font_size: sp(18)
                bold: True
                background_normal: ''
                background_color: (0.96, 0.96, 0.96, 1)
                color: (0.3, 0.3, 0.3, 1)
                size_hint_x: 0.33
                canvas.before:
                    Color:
                        rgba: 0.9, 0.9, 0.9, 1
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [dp(8),]
            
            Button:
                text: "T"
                font_size: sp(18)
                bold: True
                background_normal: ''
                background_color: (0.96, 0.96, 0.96, 1)
                color: (0.3, 0.3, 0.3, 1)
                size_hint_x: 0.33
                canvas.before:
                    Color:
                        rgba: 0.9, 0.9, 0.9, 1
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [dp(8),]