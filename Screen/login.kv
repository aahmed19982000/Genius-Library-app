#:import dp kivy.metrics.dp
#:import sp kivy.metrics.sp
#:import Window kivy.core.window.Window

<LoginScreen>:
    name: "login"
    error_message: ""
    success_message: ""
    login_success: False
    
    BoxLayout:
        orientation: "vertical"
        spacing: 0
        padding: 0
        
        # خلفية الصفحة
        canvas.before:
            Color:
                rgba: 0.98, 0.98, 0.98, 1
            Rectangle:
                pos: self.pos
                size: self.size
        
        # الحاوية الرئيسية مع تأثير الظل
        BoxLayout:
            orientation: "vertical"
            size_hint: None, None
            size: min(dp(400), Window.width * 0.9), min(dp(580), Window.height * 0.85)
            pos_hint: {"center_x": 0.5, "center_y": 0.5}
            spacing: dp(20)
            padding: [dp(25), dp(25), dp(25), dp(25)]
            canvas.before:
                Color:
                    rgba: 1, 1, 1, 1
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [dp(12),]
                Color:
                    rgba: 0, 0, 0, 0.06
                Line:
                    width: dp(1)
                    rounded_rectangle: [self.x + dp(1), self.y + dp(1), self.width - dp(2), self.height - dp(2), dp(12)]
                # تأثير الظل
                Color:
                    rgba: 0, 0, 0, 0.04
                RoundedRectangle:
                    pos: self.x + dp(3), self.y - dp(3)
                    size: self.size
                    radius: [dp(12),]
            
            # العنوان
            BoxLayout:
                orientation: "vertical"
                spacing: dp(5)
                size_hint_y: None
                height: dp(70)
                
                Label:
                    text: 'تسجيل الدخول'
                    font_name: "fonts/ArbFONTS-AwanZaman-Regular.ttf"
                    font_size: sp(30)
                    color: (25/255.0, 60/255.0, 95/255.0, 1)
                    size_hint_y: None
                    height: dp(40)
                    text_size: self.width, None
                    halign: "center"
                    valign: "middle"
                    bold: True
                
                Label:
                    text: 'أدخل بياناتك للدخول إلى حسابك'
                    font_name: "fonts/ArbFONTS-AwanZaman-Regular.ttf"
                    font_size: sp(15)
                    color: (0.4, 0.4, 0.4, 1)
                    size_hint_y: None
                    height: dp(25)
                    text_size: self.width, None
                    halign: "center"
                    valign: "top"
            
            # مسافة فارغة
            Widget:
                size_hint_y: None
                height: dp(10)
            
            # حاوية نموذج الدخول
            BoxLayout:
                orientation: "vertical"
                spacing: dp(20)
                
                # حقل اسم المستخدم
                BoxLayout:
                    orientation: "vertical"
                    spacing: dp(5)
                    size_hint_y: None
                    height: dp(75)
                    
                    Label:
                        text: 'اسم المستخدم'
                        font_name: "fonts/ArbFONTS-AwanZaman-Regular.ttf"
                        font_size: sp(16)
                        color: (0.25, 0.25, 0.25, 1)
                        size_hint_y: None
                        height: dp(22)
                        text_size: self.width, None
                        halign: "right"
                        valign: "bottom"
                        bold: True
                    
                    TextInput:
                        id: username_input
                        multiline: False
                        font_name: "fonts/ArbFONTS-AwanZaman-Regular.ttf"
                        font_size: sp(18)
                        size_hint_y: None
                        height: dp(50)
                        padding: [dp(15), dp(13)]
                        hint_text: 'أدخل اسم المستخدم'  # تم إصلاح الاقتباس هنا
                        foreground_color: (0.2, 0.2, 0.2, 1)
                        background_color: (1, 1, 1, 1)
                        halign: "right"
                        on_text:
                            root.clear_error()
                        on_focus:
                            if self.focus: self.background_color = (0.98, 0.98, 1, 1)
                            else: self.background_color = (1, 1, 1, 1)
                        canvas.before:
                            Color:
                                rgba: self.background_color
                            RoundedRectangle:
                                pos: self.pos
                                size: self.size
                                radius: [dp(6),]
                            Color:
                                rgba: 0.8, 0.8, 0.8, 1
                            Line:
                                width: dp(1.2)
                                rounded_rectangle: [self.x, self.y, self.width, self.height, dp(6)]
                
                # حقل كلمة المرور
                BoxLayout:
                    orientation: "vertical"
                    spacing: dp(5)
                    size_hint_y: None
                    height: dp(75)
                    
                    Label:
                        text: 'كلمة المرور'
                        font_name: "fonts/ArbFONTS-AwanZaman-Regular.ttf"
                        font_size: sp(16)
                        color: (0.25, 0.25, 0.25, 1)
                        size_hint_y: None
                        height: dp(22)
                        text_size: self.width, None
                        halign: "right"
                        valign: "bottom"
                        bold: True
                    
                    TextInput:
                        id: password_input
                        multiline: False
                        password: True
                        font_name: "fonts/ArbFONTS-AwanZaman-Regular.ttf"
                        font_size: sp(18)
                        size_hint_y: None
                        height: dp(50)
                        padding: [dp(15), dp(13)]
                        hint_text: 'أدخل كلمة المرور'
                        foreground_color: (0.2, 0.2, 0.2, 1)
                        background_color: (1, 1, 1, 1)
                        halign: "right"
                        on_text:
                            root.clear_error()
                        on_focus:
                            if self.focus: self.background_color = (0.98, 0.98, 1, 1)
                            else: self.background_color = (1, 1, 1, 1)
                        canvas.before:
                            Color:
                                rgba: self.background_color
                            RoundedRectangle:
                                pos: self.pos
                                size: self.size
                                radius: [dp(6),]
                            Color:
                                rgba: 0.8, 0.8, 0.8, 1
                            Line:
                                width: dp(1.2)
                                rounded_rectangle: [self.x, self.y, self.width, self.height, dp(6)]
                
                # حاوية رسالة الخطأ
                BoxLayout:
                    id: error_container
                    size_hint_y: None
                    height: 0
                    opacity: 0
                    padding: [dp(12), dp(8)]
                    
                    canvas.before:
                        Color:
                            rgba: 1, 0.92, 0.92, 1
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [dp(8),]
                        Color:
                            rgba: 1, 0.4, 0.4, 1
                        Line:
                            width: dp(1)
                            rounded_rectangle: [self.x, self.y, self.width, self.height, dp(8)]
                    
                    Label:
                        text: root.error_message
                        font_name: "fonts/ArbFONTS-AwanZaman-Regular.ttf"
                        font_size: sp(14)
                        color: (0.8, 0.1, 0.1, 1)
                        text_size: self.width, None
                        halign: "center"
                        valign: "middle"
                        bold: True
                
                # حاوية رسالة النجاح
                BoxLayout:
                    id: success_label_container
                    size_hint_y: None
                    height: 0
                    opacity: 0
                    padding: [dp(12), dp(8)]
                    
                    canvas.before:
                        Color:
                            rgba: 0.88, 0.98, 0.88, 1
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [dp(8),]
                        Color:
                            rgba: 0.2, 0.7, 0.3, 1
                        Line:
                            width: dp(1)
                            rounded_rectangle: [self.x, self.y, self.width, self.height, dp(8)]
                    
                    Label:
                        id: success_label
                        text: root.success_message
                        font_name: "fonts/ArbFONTS-AwanZaman-Regular.ttf"
                        font_size: sp(14)
                        color: (0, 0.6, 0, 1)
                        text_size: self.width, None
                        halign: "center"
                        valign: "middle"
                        bold: True
                
                # زر تسجيل الدخول
                Button:
                    id: login_button
                    text: 'تسجيل الدخول'  # نص عربي مباشر
                    font_name: "fonts/ArbFONTS-AwanZaman-Regular.ttf"
                    font_size: sp(18)
                    bold: True
                    background_normal: ''
                    background_color: (0.16, 0.65, 0.27, 1) if not root.login_success else (0.4, 0.4, 0.4, 1)
                    color: (1, 1, 1, 1)
                    size_hint_y: None
                    height: dp(50)
                    on_release: root.login()
                    disabled: root.login_success
                    canvas.before:
                        Color:
                            rgba: 0, 0, 0, 0.12 if not self.disabled else 0.05
                        RoundedRectangle:
                            pos: self.x - dp(2), self.y - dp(2)
                            size: self.width + dp(4), self.height + dp(4)
                            radius: [dp(8),]
                        Color:
                            rgba: 0.12, 0.12, 0.12, 0.08 if not self.disabled else 0.03
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [dp(6),]
            
            # روابط إضافية
            BoxLayout:
                orientation: "vertical"
                spacing: dp(15)
                size_hint_y: None
                height: dp(80)
                
                # رابط التسجيل
                BoxLayout:
                    orientation: "horizontal"
                    size_hint_y: None
                    height: dp(30)
                    spacing: dp(5)
                    
                    Label:
                        text: 'ليس لديك حساب؟'
                        font_name: "fonts/ArbFONTS-AwanZaman-Regular.ttf"
                        font_size: sp(15)
                        color: (0.35, 0.35, 0.35, 1)
                        size_hint_x: 0.6
                        text_size: self.width, None
                        halign: "right"
                        valign: "middle"
                    
                    Button:
                        text: 'سجل هنا'
                        font_name: "fonts/ArbFONTS-AwanZaman-Regular.ttf"
                        font_size: sp(15)
                        bold: True
                        background_normal: ''
                        background_color: (0, 0, 0, 0)
                        color: (0, 0.48, 1, 1)
                        size_hint_x: 0.4
                        size_hint_y: None
                        height: dp(30)
                        padding: [dp(5), 0]
                        on_release: root.show_register_screen()
                        canvas.before:
                            Color:
                                rgba: 0, 0, 0, 0.05
                            RoundedRectangle:
                                pos: self.x - dp(2), self.y - dp(2)
                                size: self.width + dp(4), self.height + dp(4)
                                radius: [dp(6),]
                
                # رابط نسيت كلمة المرور
                BoxLayout:
                    orientation: "horizontal"
                    size_hint_y: None
                    height: dp(30)
                    
                    Button:
                        text: 'هل نسيت كلمة المرور؟'
                        font_name: "fonts/ArbFONTS-AwanZaman-Regular.ttf"
                        font_size: sp(15)
                        bold: True
                        background_normal: ''
                        background_color: (0, 0, 0, 0)
                        color: (0.8, 0.35, 0, 1)
                        size_hint_x: 1
                        size_hint_y: None
                        height: dp(30)
                        on_release: root.show_forgot_password_screen()
                        canvas.before:
                            Color:
                                rgba: 0, 0, 0, 0.05
                            RoundedRectangle:
                                pos: self.x - dp(2), self.y - dp(2)
                                size: self.width + dp(4), self.height + dp(4)
                                radius: [dp(6),]
            
            # معلومات إضافية
            BoxLayout:
                orientation: "vertical"
                size_hint_y: None
                height: dp(30)
                
                Label:
                    text: '© 2024 مكتبة العبقري. جميع الحقوق محفوظة.'
                    font_name: "fonts/ArbFONTS-AwanZaman-Regular.ttf"
                    font_size: sp(11)
                    color: (0.5, 0.5, 0.5, 1)
                    text_size: self.width, None
                    halign: "center"
                    valign: "middle"